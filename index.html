<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dark Synth PS1-Style Audio Visualizer</title>

<style>
body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #000;
    height: 100vh;
    font-family: 'Courier New', monospace;
    color: #ff0066;
}

canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

#loader {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 10px 14px;
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid #ff0066;
    border-radius: 8px;
    z-index: 100;
    text-shadow: 0 0 10px #ff0066;
    display: flex;
    align-items: center;
    gap: 10px;
}

#loader.loaded {
    border-color: #00ff00;
    color: #00ff00;
    text-shadow: 0 0 10px #00ff00;
}

#loader.failed {
    border-color: #ff0000;
    color: #ff0000;
    text-shadow: 0 0 10px #ff0000;
}

#playBtn,
#uploadBtn {
    font-size: 1.4em;
    cursor: pointer;
    user-select: none;
}

#trackName {
    font-size: 0.75em;
    opacity: 0.85;
    max-width: 180px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

#info {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 10;
    text-shadow: 0 0 20px #ff0066;
}

#info h1 {
    font-size: 2.5em;
    margin-bottom: 0.5em;
}

#info p {
    font-size: 1.3em;
}

input[type="file"] {
    display: none;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div id="loader">
    <span id="playBtn">‚ñ∂Ô∏è</span>
    <span id="uploadBtn">üìÇ</span>
    <div id="trackName">Loading‚Ä¶</div>
</div>

<div id="info">
    <h1>DARK SYNTH VISUALIZER</h1>
    <p>Press ‚ñ∂Ô∏è to start<br>or üìÇ to load your own track</p>
</div>

<input type="file" id="fileInput" accept="audio/mp3,audio/mpeg">
<audio id="audio" preload="auto"></audio>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const audio = document.getElementById('audio');
const loader = document.getElementById('loader');
const playBtn = document.getElementById('playBtn');
const uploadBtn = document.getElementById('uploadBtn');
const trackName = document.getElementById('trackName');
const info = document.getElementById('info');
const fileInput = document.getElementById('fileInput');

let audioCtx, analyser, source, dataArray, bufferLength;
let started = false;

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

/* Default track */
audio.src = "your-track.mp3";
audio.load();
trackName.textContent = "your-track.mp3";

audio.addEventListener('canplaythrough', () => {
    loader.classList.add('loaded');
});

audio.addEventListener('error', () => {
    loader.classList.add('failed');
    trackName.textContent = "Failed to load";
});

/* Audio init */
function initAudio() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);

    source = audioCtx.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(audioCtx.destination);

    if (audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
}

/* Play / Pause */
playBtn.addEventListener('click', () => {
    if (!started) {
        initAudio();
        started = true;
        info.style.display = 'none';
        animate();
    }

    if (audio.paused) {
        audio.play().catch(() => {
            loader.classList.add('failed');
            trackName.textContent = "Playback blocked";
        });
    } else {
        audio.pause();
    }
});

audio.addEventListener('play', () => playBtn.textContent = "‚è∏");
audio.addEventListener('pause', () => playBtn.textContent = "‚ñ∂Ô∏è");

/* Upload */
uploadBtn.addEventListener('click', () => {
    fileInput.click();
});

fileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file && file.type === 'audio/mpeg') {
        audio.src = URL.createObjectURL(file);
        trackName.textContent = file.name;
        loader.classList.remove('failed');
        loader.classList.add('loaded');
    }
});

/* Visualizer */
let particles = [];

function animate() {
    requestAnimationFrame(animate);

    ctx.fillStyle = 'rgba(0,0,0,0.08)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (!analyser) return;

    analyser.getByteFrequencyData(dataArray);

    const cx = canvas.width / 2;
    const cy = canvas.height / 2;

    let bassSum = 0;
    for (let i = 0; i < 40; i++) bassSum += dataArray[i];
    const bass = bassSum / (40 * 255);

    const pulse = 80 + bass * 450;
    const grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, pulse);
    grad.addColorStop(0, 'rgba(255,0,102,1)');
    grad.addColorStop(0.4, 'rgba(255,0,102,0.5)');
    grad.addColorStop(1, 'rgba(0,255,255,0)');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(cx, cy, pulse, 0, Math.PI * 2);
    ctx.fill();

    const bars = 128;
    for (let i = 0; i < bars; i++) {
        const angle = i / bars * Math.PI * 2;
        const idx = Math.floor(i / bars * bufferLength);
        const h = (dataArray[idx] / 255) * 600 + bass * 300;
        const r = 140 + bass * 120;

        ctx.strokeStyle = `rgba(255,0,102,${0.7 + bass * 0.3})`;
        ctx.lineWidth = 6 + bass * 12;
        ctx.shadowBlur = 40 + bass * 60;
        ctx.shadowColor = '#ff0066';

        ctx.beginPath();
        ctx.moveTo(cx + Math.cos(angle) * r, cy + Math.sin(angle) * r);
        ctx.lineTo(cx + Math.cos(angle) * (r + h), cy + Math.sin(angle) * (r + h));
        ctx.stroke();
    }
    ctx.shadowBlur = 0;

    if (bass > 0.65 && Math.random() > 0.3) {
        for (let i = 0; i < 10; i++) {
            const a = Math.random() * Math.PI * 2;
            particles.push({
                x: cx,
                y: cy,
                vx: Math.cos(a) * (20 + bass * 50),
                vy: Math.sin(a) * (20 + bass * 50),
                life: 45,
                color: i % 2 ? '#00ffff' : '#ff0066'
            });
        }
    }

    particles = particles.filter(p => p.life > 0);
    particles.forEach(p => {
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 1.8;

        ctx.strokeStyle = p.color;
        ctx.lineWidth = p.life / 7;
        ctx.shadowBlur = 25;
        ctx.shadowColor = p.color;

        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();
    });
    ctx.shadowBlur = 0;
}
</script>

</body>
</html>
